#' Visualization of the simulation results.
#'
#' \code{plot_sim_result} is the visualization of the results generated by \code{\link{draw_donorpool}}.
#' It contains both the actural and conunterfactual value of target across treatment time point.
#'
#' @param result The object generated by the \code{\link{draw_donorpool}}.
#'
#' @return The ggplot object visualizing the simulation results.
#' @importFrom magrittr "%>%"
#' @importFrom foreach "%do%"
#' @export
plot_sim_result <- function(result) {
  # First generate the treatment period variables
  period_min <- result$Simulation_Result %>%
    dplyr::filter(treatment_dummy == 1) %>%
    dplyr::select(time) %>%
    head(1) %>%
    .[1,1]

  period_max <- result$Simulation_Result %>%
    dplyr::filter(treatment_dummy == 1) %>%
    dplyr::select(time) %>%
    tail(1) %>%
    .[1,1]

  # Gather the actural and counterfactual value
  sim_result <- result$Simulation_Result %>%
    tidyr::gather(key = "key", value = "Value", -time, -treatment_dummy)

  # Plot the figure
  plot_sim_result_object <- sim_result %>%
    ggplot2::ggplot(ggplot2::aes(time, Value, group = key, color = key)) +
    ggplot2::annotate("rect", xmin = period_min, xmax = period_max,
             ymin = -Inf, ymax = Inf,
             fill = "grey", colour = "grey", alpha = 0.4) +
    ggplot2::geom_point() +
    ggplot2::geom_line() +
    ggplot2::scale_colour_discrete(name = "",
                          breaks = c("y_actural", "y_sim"),
                          labels = c("Actual", "Counterfactural")) +
    ggplot2::xlab("Time") +
    ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90, hjust = 1))

  return(plot_sim_result_object)
}
